<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

<html>
<head>
    <title id="doc_title">[Unknown Title]</title>   
   
    <!--jquery load, 1.4 works best -->
    <script type="text/javascript" src="js/jquery-1.4.2.min.js"></script>    
    <script type="text/javascript" src="js/jquery-ui-1.8.5.custom.min.js"></script>
    <script type="text/javascript" src="js/dragscrollable.js"></script>    
    <!-- <script type="text/javascript" src="js/jquery.ui.ipad.js"></script> -->
    <script type="text/javascript" src="js/jquery.bt.min.js"></script>    

    <!-- Main BookReader JS and CSS // "WSU" prefix for modified versions-->
    <script type="text/javascript" src="js/WSU_bookreader.js"></script>        
    <link id="css_icons" rel="stylesheet" type="text/css" href="css/elusive-iconset/css/elusive-webfont.css"/>
    <!--[if lte IE 7]><script src="css/elusive-iconset/lte-ie7.js"></script><![endif]-->    
    <link id="css_pointer" rel="stylesheet" type="text/css" href="css/WSU_BookReader.css"/>

    <!-- Load BR init and local functionality -->
    <script type="text/javascript" src="js/WSUlaunch.js"></script>    
    <script type="text/javascript" src="js/WSU_js.js"></script>
    <script type="text/javascript" src="js/fullscreen_API.js"></script>

    <!--URL hash detector / used to detect page changing-->
    <script type="text/javascript" src="js/hashchange.js"></script>

    <!--jplayer -->
    <script type="text/javascript" src="inc/jPlayer/jquery.jplayer.min.js"></script>
    <script type="text/javascript" src="js/jplayer.say.js"></script>   

    <!--jquery highlight-->
    <script type="text/javascript" src="js/jquery.highlight.js"></script> 

    <!--colorbox for metadata information-->
    <script src="js/jquery.colorbox-min.js"></script>
    <link rel="stylesheet" type="text/css" href="inc/colorbox/itemMetadata/colorbox.css"/>

    <!--mobile detection script-->
    <script src="js/detectMobile.js"></script>

    <!--NON-MOBILE ONLY-->
    <!--magnifier / tjpzoom -->    
    <script type="text/javascript" src="js/jquery.loupe.js"></script>
    <!--jQuery Rotate -->
    <script type="text/javascript" src="js/jQueryRotate.2.2.js"></script>
</head>

<body>
    <div id="bookreader_wrapper">    

        <div id="overlays"></div>

        <div id="WSUtoolbar" class="shadow">           
            <p>This book reader requires JavaScript to be enabled. Please check that your browser or device supports JavaScript and that it is enabled.</p>
        </div>

        <!--Set minimize arrow outside of toolbar structure, turned on in postLaunch function -->
        <div id="WSUtoolbar_minimize" class="toolbar_exposed" onclick="toolbarsMinimize(); return false;" title="Show/hide nav bar">
            <ul class="the-icons">                        
                <li><i id="minimize_handle" class="icon-chevron-up"></i></li>
            </ul>
        </div>

        <!-- Containing and target DIV for bookreader construction-->
        <div id="BookReader">        
            <p>This book reader requires JavaScript to be enabled. Please check that your browser or device supports JavaScript and that it is enabled.</p>           
        </div>        

    </div> <!--closes bookreader_wrapper-->
    
    <!-- Get Item ID & Metadata, launch BookReader -->
    <script type="text/javascript">
        //this is setting global "ItemID" still used by Solr
        var ItemID = getURLParam('ItemID');        
        var mobileRequest = getURLParam('m');        
        var PIDsafe = ItemID.replace(/_/g,"");

        $(document).ready(function() {            
            var metaquery = 'php/fedora_XML_request.php?PIDsafe='+PIDsafe+'&datastream=STRUCT_META&datatype=xml';                       

            //returns json
            $(document).ready(function(){
              $.ajax({
                type: "GET",
                url: metaquery,
                dataType: "json",
                success: pull_meta
              });
            });

            function pull_meta(response){   
                console.log(response)
                var pheight = response.dimensions.pheight;
                var pwidth = response.dimensions.pwidth;
                var leafs = response.dimensions.leafs;                
                var PIDsafeID = response.PIDsafe;
                var item_ID = response.item_ID;
                var collectionID = response.collection;
                var baseURL = "http://141.217.172.152:8080/";
                var solr_baseURL = "http://localhost:8080/solr4/bookreader/";
                //sets things in motion to launchBookReader()
                launchBookReader(PIDsafeID, leafs, pheight, pwidth, item_ID, collectionID, baseURL, solr_baseURL, mobileRequest);
            }
        });
    </script>    

</body>
</html>
