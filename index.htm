<html>
<head>
	<!-- kube stylesheet -->
	<link rel="stylesheet" type="text/css" href="css/kube101/css/kube.css" />
	<!-- local stylesheet -->
	<link rel="stylesheet" href="css/blauncher.css" type="text/css">
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

	<script type="text/javascript">
		//global variable
		book_PIDS = [];
		var book_names = new Object();

		function drawThumbs(){
			for (var i = 0; i < book_PIDS.length; ++i){			
				$("#item_thumbs").append("<div class='fifth'><a href='eTextReader.php?ItemID="+book_PIDS[i]+"#page/1/mode/2up'><img class='shadow' src='http://fedora.lib.wayne.edu:8080/fedora/objects/"+book_PIDS[i].split(':')[1]+":thumbs/datastreams/THUMB_1/content'/></a><div class='row container'><div class='thumb_text'>"+book_PIDS[i]+"</div></div></div>")
			}
			$("#item_thumbs").fadeIn();			
		}


		function getCollectionItems(){
		$(document).ready(function() {
	        // test url
	        dataObject = new Object();        
	        dataObject.data_type = "html";

	        // dataObject.data_type = "json";
	        var baseURL = "http://localhost:8080/fedora/risearch?"; //this needs to be "localhost" when running in parallel, this is passed to a PHP script
	        var queryOptions = "type=tuples&lang=itql&format=json&dt=on&stream=on&query=";
	        var baseQuery = "select $subject from <#ri> where $subject <fedora-rels-ext:isMemberOfCollection> <fedora:collection:MIM>";
	        dataObject.encodedQueryURL = baseURL + queryOptions + encodeURIComponent(baseQuery);        

			//returns json
	        $(document).ready(function(){
	          $.ajax({
	            type: "POST",
	            url: "php/ebook_object_tunnel.php",
	            data: dataObject,
	            dataType: "json",
	            success: pull_meta
	          });
	        });

	        function pull_meta(response){               
	            console.log(response);

	            // create list of PIDs that match query            
	            for (var i = 0; i < response.results.length; ++i){  
	            	book_PIDS.push(response.results[i].subject.split('/')[1]);            	            	
	        	}

	        	//do it!
	        	drawThumbs();        	  	
	    	}

			

		});
	}
	</script>
	
</head>

<body>

<div id="container">

	<div id="title" class="row">
		<h3>Made in Michigan Writers Series</h3>
	</div>

	<div id='item_thumbs' style="display:none;"></div>

	<script type="text/javascript">
		getCollectionItems();	
	</script>	

</div>

</body>
</html>










